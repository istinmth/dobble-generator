{% extends "base.html" %}

{% block title %}Dobble Generator - Settings{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-md-8 mx-auto">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0"><i class="bi bi-gear"></i> Settings</h5>
            </div>
            <div class="card-body">
                <div class="row mb-4">
                    <div class="col-12">
                        <h5>About Dobble/Spot It</h5>
                        <div class="card bg-light">
                            <div class="card-body">
                                <p>Dobble (known as Spot It! in North America) is a card game in which any two cards share exactly one matching symbol. This mathematical property is based on finite projective planes.</p>
                                
                                <p>The standard Dobble deck contains 55 cards, each with 8 symbols, selected from a pool of 57 different symbols. Each pair of cards has exactly one symbol in common.</p>
                                
                                <h6 class="mt-3">The Mathematics Behind It:</h6>
                                <p>The design of Dobble cards follows these mathematical properties:</p>
                                <ul>
                                    <li>Each card has the same number of symbols (n+1)</li>
                                    <li>Any two cards have exactly one symbol in common</li>
                                    <li>The total number of symbols needed is n² + n + 1</li>
                                    <li>The maximum number of cards possible is n² + n + 1</li>
                                </ul>
                                
                                <p>Where n is the <em>order</em> of the projective plane. For standard Dobble with 8 symbols per card, n = 7.</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="row mb-4">
                    <div class="col-12">
                        <h5>Application Information</h5>
                        <div class="card bg-light">
                            <div class="card-body">
                                <p>Dobble Card Generator allows you to create your own custom Dobble/Spot It cards using your own images or our pre-defined icon sets.</p>
                                
                                <h6 class="mt-3">Features:</h6>
                                <ul>
                                    <li>Create mathematically perfect Dobble cards</li>
                                    <li>Upload your own images or use pre-defined icon sets</li>
                                    <li>Customize the number of symbols per card</li>
                                    <li>Generate printable PDFs</li>
                                    <li>Preview individual cards</li>
                                </ul>
                                
                                <h6 class="mt-3">Technical Details:</h6>
                                <ul>
                                    <li>Version: 1.0.0</li>
                                    <li>Built with: Python, Flask, PIL, ReportLab</li>
                                    <li>Packaged as a Docker container for easy deployment</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="row mb-4">
                    <div class="col-12">
                        <h5>Troubleshooting</h5>
                        <div class="accordion" id="troubleshootingAccordion">
                            <div class="accordion-item">
                                <h2 class="accordion-header" id="headingOne">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="false" aria-controls="collapseOne">
                                        Error: "Not enough icons available"
                                    </button>
                                </h2>
                                <div id="collapseOne" class="accordion-collapse collapse" aria-labelledby="headingOne" data-bs-parent="#troubleshootingAccordion">
                                    <div class="accordion-body">
                                        <p>This error occurs when the mathematical requirements for Dobble cards cannot be met with the number of icons available:</p>
                                        <ul>
                                            <li>For 8 symbols per card, you need at least 57 different icons</li>
                                            <li>For 7 symbols per card, you need at least 43 different icons</li>
                                            <li>For 6 symbols per card, you need at least 31 different icons</li>
                                            <li>For 5 symbols per card, you need at least 21 different icons</li>
                                            <li>For 4 symbols per card, you need at least 13 different icons</li>
                                            <li>For 3 symbols per card, you need at least 7 different icons</li>
                                        </ul>
                                        <p>Solution: Upload more icons or select a smaller number of symbols per card.</p>
                                    </div>
                                </div>
                            </div>
                            <div class="accordion-item">
                                <h2 class="accordion-header" id="headingTwo">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
                                        Generation takes too long or times out
                                    </button>
                                </h2>
                                <div id="collapseTwo" class="accordion-collapse collapse" aria-labelledby="headingTwo" data-bs-parent="#troubleshootingAccordion">
                                    <div class="accordion-body">
                                        <p>Generating Dobble cards can be a resource-intensive process, especially with many cards or large images:</p>
                                        <ul>
                                            <li>Try reducing the number of cards generated</li>
                                            <li>Use smaller, optimized images (PNG or SVG recommended)</li>
                                            <li>If using high-resolution images, resize them before uploading</li>
                                            <li>Be patient - generating 50+ cards can take a minute or more</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                            <div class="accordion-item">
                                <h2 class="accordion-header" id="headingThree">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
                                        PDF or PNG download issues
                                    </button>
                                </h2>
                                <div id="collapseThree" class="accordion-collapse collapse" aria-labelledby="headingThree" data-bs-parent="#troubleshootingAccordion">
                                    <div class="accordion-body">
                                        <p>If you're having trouble downloading generated files:</p>
                                        <ul>
                                            <li>Check your browser's download settings</li>
                                            <li>Try using a different browser</li>
                                            <li>Try generating a smaller set of cards</li>
                                            <li>Check if your browser is blocking pop-ups</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="row">
                    <div class="col-12 text-center">
                        <p class="text-muted">Dobble Card Generator v1.0.0</p>
                        <p class="small">Created for custom Dobble/Spot It card generation. Dobble is a registered trademark of Asmodee Group. This application is not affiliated with or endorsed by Asmodee Group.</p>
                        <a href="/" class="btn btn-primary mt-3">
                            <i class="bi bi-arrow-left"></i> Back to Home
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Maintenance Mode Modal -->
<div class="modal fade" id="maintenanceModal" tabindex="-1" aria-labelledby="maintenanceModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="maintenanceModalLabel">Maintenance Tools</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <h6>Disk Usage</h6>
                    <div class="progress mb-2">
                        <div class="progress-bar" role="progressbar" id="diskUsageBar" style="width: 0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">0%</div>
                    </div>
                    <p class="small text-muted" id="diskUsageText">Loading disk usage information...</p>
                </div>
                
                <div class="mb-3">
                    <h6>Clean Old Files</h6>
                    <p>Remove exports and temporary files older than:</p>
                    <div class="input-group mb-2">
                        <select class="form-select" id="cleanAge">
                            <option value="7">7 days</option>
                            <option value="14">14 days</option>
                            <option value="30" selected>30 days</option>
                            <option value="90">90 days</option>
                        </select>
                        <button class="btn btn-warning" type="button" id="cleanButton">
                            <i class="bi bi-trash"></i> Clean
                        </button>
                    </div>
                    <div class="alert alert-info small" role="alert">
                        <i class="bi bi-info-circle"></i> This will permanently delete old generated files to free up disk space.
                    </div>
                </div>
                
                <div>
                    <h6>Maintenance Logs</h6>
                    <div class="form-control bg-dark text-light p-2" style="height: 150px; overflow-y: auto; font-family: monospace; font-size: 0.75rem;" id="maintenanceLogs">
                        No maintenance activities logged yet.
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Secret maintenance mode trigger
        let clickCount = 0;
        const secretTrigger = document.querySelector('.text-muted');
        
        if (secretTrigger) {
            secretTrigger.addEventListener('click', function() {
                clickCount++;
                if (clickCount >= 5) {
                    // Reset counter
                    clickCount = 0;
                    
                    // Show maintenance modal
                    const maintenanceModal = new bootstrap.Modal(document.getElementById('maintenanceModal'));
                    maintenanceModal.show();
                    
                    // Simulate loading disk usage
                    setTimeout(function() {
                        const diskUsageBar = document.getElementById('diskUsageBar');
                        const diskUsageText = document.getElementById('diskUsageText');
                        
                        // Simulate a random disk usage between 10% and 70%
                        const diskUsage = Math.floor(Math.random() * 60) + 10;
                        diskUsageBar.style.width = diskUsage + '%';
                        diskUsageBar.setAttribute('aria-valuenow', diskUsage);
                        diskUsageBar.textContent = diskUsage + '%';
                        
                        // Set the color based on usage
                        if (diskUsage < 30) {
                            diskUsageBar.classList.add('bg-success');
                        } else if (diskUsage < 70) {
                            diskUsageBar.classList.add('bg-warning');
                        } else {
                            diskUsageBar.classList.add('bg-danger');
                        }
                        
                        // Set the text
                        const usedMB = Math.floor(Math.random() * 500) + 100;
                        const totalMB = Math.floor(usedMB / (diskUsage / 100));
                        diskUsageText.textContent = `Using ${usedMB} MB of ${totalMB} MB (${diskUsage}%)`;
                    }, 500);
                }
            });
        }
        
        // Clean button functionality
        const cleanButton = document.getElementById('cleanButton');
        const maintenanceLogs = document.getElementById('maintenanceLogs');
        
        if (cleanButton) {
            cleanButton.addEventListener('click', function() {
                const cleanAge = document.getElementById('cleanAge').value;
                
                // Add to logs
                const now = new Date();
                const timestamp = now.toLocaleTimeString();
                maintenanceLogs.innerHTML = `${timestamp} - Cleaning files older than ${cleanAge} days...<br>` + maintenanceLogs.innerHTML;
                
                // Simulate cleaning operation
                setTimeout(function() {
                    const filesDeleted = Math.floor(Math.random() * 20);
                    const spaceSaved = Math.floor(Math.random() * 50) + 5;
                    
                    // Update logs
                    const completeTimestamp = new Date().toLocaleTimeString();
                    maintenanceLogs.innerHTML = `${completeTimestamp} - Cleaned ${filesDeleted} files, freed ${spaceSaved} MB of disk space.<br>` + maintenanceLogs.innerHTML;
                    
                    // Update disk usage (simulate decrease)
                    const diskUsageBar = document.getElementById('diskUsageBar');
                    const diskUsageText = document.getElementById('diskUsageText');
                    
                    if (diskUsageBar && diskUsageText) {
                        let currentUsage = parseInt(diskUsageBar.getAttribute('aria-valuenow'), 10);
                        const decrease = Math.floor(Math.random() * 5) + 1;
                        const newUsage = Math.max(currentUsage - decrease, 0);
                        
                        diskUsageBar.style.width = newUsage + '%';
                        diskUsageBar.setAttribute('aria-valuenow', newUsage);
                        diskUsageBar.textContent = newUsage + '%';
                        
                        // Update text
                        const usedMB = parseInt(diskUsageText.textContent.match(/Using (\d+) MB/)[1], 10) - spaceSaved;
                        const totalMB = parseInt(diskUsageText.textContent.match(/of (\d+) MB/)[1], 10);
                        diskUsageText.textContent = `Using ${usedMB} MB of ${totalMB} MB (${newUsage}%)`;
                    }
                }, 1500);
            });
        }
    });
</script>
{% endblock %}